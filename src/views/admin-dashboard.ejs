<section class="max-w-6xl mx-auto px-4 py-6">

  <div class="sticky top-16 z-30 bg-gray-100 pb-4">
    <div class="flex flex-wrap items-end justify-between gap-4 mb-4">
      <div>
        <h1 class="text-2xl font-bold">ğŸ“Š Admin â€“ All Bookings</h1>
        <p class="text-sm text-gray-600">Monitor bookings & payments</p>
      </div>

      <div class="bg-white border rounded-lg px-4 py-2 text-sm font-semibold">
        ğŸ’° Revenue: â‚¹<span id="revenueTotal">0</span>
      </div>
    </div>

    <div class="flex flex-wrap gap-3 items-center">
      <div class="flex gap-2">
        <button data-filter="all" class="filter-btn active">All</button>
        <button data-filter="paid" class="filter-btn">Paid</button>
        <button data-filter="pending" class="filter-btn">Pending</button>
        <button data-filter="cancelled" class="filter-btn">Cancelled</button>
      </div>

      <input id="searchInput" placeholder="Search email or experience..." class="search-input" />

      <button id="exportBtn" class="export-btn">Export CSV</button>
    </div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4 mt-6">
    <% bookings.forEach(b=> { %>
      <div class="booking-card bg-white rounded-xl p-4 shadow-sm flex flex-col gap-3"
        data-payment="<%= b.paymentStatus %>" data-status="<%= b.status %>"
        data-email="<%= b.userId?.email?.toLowerCase() || "" %>"
        data-title="<%= b.experienceId?.title?.toLowerCase() || "" %>" data-date="<%= b.date %>"
        data-time="<%= b.time %>" data-qty="<%= b.qty %>"
        data-created="<%= new Date(b.createdAt).toLocaleDateString() %>"
        data-amount="<%= b.paymentStatus === 'paid' ? Number(b.amountPaid || 0) : 0 %>">

        <!-- HEADER -->
        <div class="flex justify-between gap-2">
          <div class="min-w-0">
            <h3 class="font-semibold text-sm truncate">
              <%= b.experienceId?.title || "Deleted Experience" %>
            </h3>
            <p class="text-xs text-gray-500 truncate">
              ğŸ‘¤ <%= b.userId?.email || "Deleted User" %>
            </p>
          </div>

          <span class="px-2 py-0.5 text-xs rounded-full font-semibold
            <%= b.paymentStatus === 'paid'
              ? 'bg-green-100 text-green-700'
              : 'bg-yellow-100 text-yellow-700'
            %>">
            <%= b.paymentStatus.toUpperCase() %>
          </span>
        </div>

        <!-- META -->
        <div class="grid grid-cols-2 gap-y-1 text-xs text-gray-600">
          <span>ğŸ“… <%= b.date %></span>
          <span>â° <%= b.time %></span>
          <span>ğŸ‘¥ Qty: <%= b.qty %></span>
          <span>ğŸ•’ <%= new Date(b.createdAt).toLocaleDateString() %></span>
        </div>

        <!-- FOOTER -->
        <div class="mt-auto flex items-center justify-between">
          <span class="px-2 py-0.5 text-xs rounded-full
            <%= b.status === 'confirmed'
              ? 'bg-blue-100 text-blue-700'
              : 'bg-red-100 text-red-600'
            %>">
            <%= b.status.toUpperCase() %>
          </span>

          <span class="text-xs font-semibold text-gray-700">
            â‚¹ <%= b.paymentStatus==='paid' ? Number(b.amountPaid || 0) : 0 %>
          </span>
        </div>

      </div>
      <% }) %>
  </div>

</section>

<link rel="stylesheet" href="/admin.css">
<script defer src="/admin-dashboard.js"></script>